# 개발 환경용 Docker Compose Override 설정
# 사용법: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up --build
# 또는: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up --build -d (백그라운드 실행)

services:
  # Next.js 애플리케이션 - 개발 모드
  nextjs-app:
    build:
      context: .
      dockerfile: Dockerfile.dev # 개발용 Dockerfile 사용
      args:
        - DATABASE_URL
    volumes:
      # 호스트의 소스 코드를 컨테이너에 마운트하여 코드 변경 시 즉시 반영
      - .:/app
      # node_modules는 호스트와 컨테이너 간 충돌을 방지하기 위해 별도 볼륨
      - /app/node_modules
      - /app/.next # Next.js 캐시 폴더
      # start.sh 스크립트 마운트
      - ./docker/start.sh:/start.sh
    environment:
      # 개발 모드에서는 NODE_ENV를 development로 설정
      NODE_ENV: development
      # Turbopack 사용 (더 빠른 개발 서버)
      TURBOPACK: 1
    # 시작 시 db:setup 자동 실행
    command: ["sh", "/start.sh"]
    # 개발 시에는 stdin/stdout을 열어두어 로그 확인 가능
    stdin_open: true
    tty: true

  # Socket.IO 서버 - 프로덕션 빌드 사용 (볼륨 마운트 불필요)
  # 소스 코드 변경이 자주 일어나지 않으므로 기본 설정 사용
